@using Toad.Web.Models
@using Toad.Data
@model List<CommentModel>
    
@{
    ViewBag.Title = "Read";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

    @{
        var change = (ChangeTable)ViewData["change"];
        var user = (UserTable)ViewData["author"];
        var x = ViewData["changeConstraints"] as List<ConstraintTable>;
    }

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-timeago/1.5.4/jquery.timeago.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#postTime").timeago();
        });
    </script>
    <div class="breadcrumbs">
        <section class="container">
            <div class="row">
                <div class="col-md-12">
                    <h1>@change.Title</h1>
                </div>
                <div class="col-md-12">
                    <div class="crumbs">
                        <a href="#">Home</a>
                        <span class="crumbs-span">/</span>
                        <a href="#">Change</a>
                        <span class="crumbs-span">/</span>
                        <span class="current">@change.Title</span>
                    </div>
                </div>
            </div><!-- End row -->
        </section><!-- End container -->
    </div>
    <section class="container main-content">
        <div class="row">
            <div class="col-md-12">
                <article class="question single-question question-type-normal">
                    <h2>
                        <a href="single_question.html">@change.Title</a>
                    </h2>
                    <div class="question-inner">
                        <div class="clearfix"></div>
                        <div class="question-desc">
                            <p>@change.Details</p>
                        </div>
                        <div class="question-details">
                            @*<span class="question-answered question-answered-done"><i class="icon-ok"></i>solved</span>
                            <span class="question-favorite"><i class="icon-star"></i>5</span>*@
                        </div>
                        @*<span class="question-category"><a href="#"><i class="icon-folder-close"></i>wordpress</a></span>*@
                        <span class="question-date"><time id="postTime" class="timeago icon-time" datetime="@ViewData["time"]">@ViewData["time"]</time></span>
                        <span class="question-comment"><a href="#"><i class="icon-comment"></i>@Model.Count Proposals</a></span>
                        <span class="question-comment"><i class="icon-user"></i>Views @ViewData["views"]</span>
                        <span class="question-view"><i class="icon-user"></i>Follower @ViewData["followers"]</span>
                        @if(User.Identity.IsAuthenticated == true) {
                        <span class=""><a id="btnFollow" class="follow btn" title="Follow"><i>Follow</i></a></span>
                        }
                        <div class="clearfix"></div>
                    </div>
                </article>

                <div class="share-tags page-content">
                    <div class="question-tags">
                        @foreach (var item in ViewData["tags"] as List<TagTable>)
                        {
                            <a href="#">@item.Title</a>
                        }
                    </div>
                    <div class="share-inside-warp">
                        <ul>
                            <li>
                                <a href="#" original-title="Facebook">
                                    <span class="icon_i">
                                        <span class="icon_square" icon_size="20" span_bg="#3b5997" span_hover="#666" style="height: 20px; width: 20px; font-size: 10px; line-height: 20px; background-color: rgb(59, 89, 151); border-style: solid;">
                                            <i i_color="#FFF" class="social_icon-facebook" style="color: rgb(255, 255, 255);"></i>
                                        </span>
                                    </span>
                                </a>
                                <a href="#" target="_blank">Facebook</a>
                            </li>
                            <li>
                                <a href="#" target="_blank">
                                    <span class="icon_i">
                                        <span class="icon_square" icon_size="20" span_bg="#00baf0" span_hover="#666" style="height: 20px; width: 20px; font-size: 10px; line-height: 20px; background-color: rgb(0, 186, 240); border-style: solid;">
                                            <i i_color="#FFF" class="social_icon-twitter" style="color: rgb(255, 255, 255);"></i>
                                        </span>
                                    </span>
                                </a>
                                <a target="_blank" href="#">Twitter</a>
                            </li>
                            <li>
                                <a href="#" target="_blank">
                                    <span class="icon_i">
                                        <span class="icon_square" icon_size="20" span_bg="#ca2c24" span_hover="#666" style="height: 20px; width: 20px; font-size: 10px; line-height: 20px; background-color: rgb(202, 44, 36); border-style: solid;">
                                            <i i_color="#FFF" class="social_icon-gplus" style="color: rgb(255, 255, 255);"></i>
                                        </span>
                                    </span>
                                </a>
                                <a href="#" target="_blank">Google plus</a>
                            </li>
                            <li>
                                <a href="#" target="_blank">
                                    <span class="icon_i">
                                        <span class="icon_square" icon_size="20" span_bg="#e64281" span_hover="#666" style="height: 20px; width: 20px; font-size: 10px; line-height: 20px; background-color: rgb(230, 66, 129); border-style: solid;">
                                            <i i_color="#FFF" class="social_icon-dribbble" style="color: rgb(255, 255, 255);"></i>
                                        </span>
                                    </span>
                                </a>
                                <a href="#" target="_blank">Dribbble</a>
                            </li>
                            <li>
                                <a target="_blank" href="#">
                                    <span class="icon_i">
                                        <span class="icon_square" icon_size="20" span_bg="#c7151a" span_hover="#666" style="height: 20px; width: 20px; font-size: 10px; line-height: 20px; background-color: rgb(199, 21, 26); border-style: solid;">
                                            <i i_color="#FFF" class="icon-pinterest" style="color: rgb(255, 255, 255);"></i>
                                        </span>
                                    </span>
                                </a>
                                <a href="#" target="_blank">Pinterest</a>
                            </li>
                        </ul>
                        <span class="share-inside-f-arrow"></span>
                        <span class="share-inside-l-arrow"></span>
                    </div><!-- End share-inside-warp -->
                    <div id="precursorDiv">
                        <h2>Precursor</h2>

                    </div>
                    <div class="row">
                        <div class="col-md-6 ">
                            <div class="precursorBorder">
                                <ul class="list-group">
                                    @foreach (var item in @ViewData["changePrecursor"] as List<ChangeTable>)
                                    {
                                        <li class="list-group-item">
                                            <a href="~/Change/Read/@item.SearchTitle" target="_blank">@item.Title</a>
                                        </li>
                                    }
                                </ul>
                            </div>
                        </div>
                        @if(User.Identity.IsAuthenticated == true) {

                        <div class="col-md-6 borderRight">
                            <div class="">
                                <span><input type="text" id="searchInput" placeholder="Add a precursor" /></span>
                                <div class="precursorBorder"><ul id="precursorList" class="list-group"></ul></div>
                            </div>
                        </div>
                        }
                    </div>
                        


                    <div class="clearfix"></div>
                </div><!-- End share-tags -->

@if (x.Count != 0)
{

                <div class="share-tags page-content">
                    <div class="question-tags">
                        @foreach (var item in ViewData["tags"] as List<TagTable>)
                        {
                            <a href="#">@item.Title</a>
                        }
                    </div>
                    <div class="share-inside-warp">

                    </div><!-- End share-inside-warp -->
                   
                       
                            <div id="precursorDiv">
                                <h2>Constraints</h2>

                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="precursorBorder">
                                        <ul class="list-group">
                                            @foreach (var item in @ViewData["changeConstraints"] as List<ConstraintTable>)
                                            {
                                                <li class="list-group-item">
                                                    <span>@item.Content</span>
                                                </li>
                                            }
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-md-6 borderRight">
                                    <div class="">
                                        <span><input type="text" id="txtAddConstraint" placeholder="Add a constraint" /><span><input type="button" id="btnAddConstraint" value="Add" /></span></span>
                                        <div class="precursorBorder"><ul id="precursorList" class="list-group"></ul></div>
                                    </div>
                                </div>
                            </div>
                        

                        <div class="clearfix"></div>
</div><!-- End share-tags -->


}


                <div class="about-author clearfix">
                    <div class="author-image">
                        <a href="#" original-title="admin" class="tooltip-n"><img alt="" src="http://placehold.it/60x60/FFF/444"></a>

                    </div>
                    <div class="author-bio">
                        <div class="container">
                            <div class="row">
                                <h4>About the Author</h4>
                                <h5 style="margin-bottom:0px"><span>@user.FirstName @user.LastName</span></h5> <div><span class="question-view"><i class="icon-user"></i>Follower @ViewData["UserFollowers"]</span></div>
                                
                            </div>
                            <div class="row"><div>@user.TagLine</div></div>
                            <div class="row">
                                <p>@user.ShortDescription</p>
                            </div>
                            
                            @if (User.Identity.IsAuthenticated == true)
                            {
                                <div class="row"><span class=""><a id="btnFollowUser" class="btn follow" title="Follow" style="float:none !important"><i>Follow</i></a></span></div>
                            }
                        </div>
                    </div>
                </div><!-- End about-author -->

                @if ((ViewData["relatedQuestions"] as List<ChangeTable>).Count != 0)
                {
                    <div id="related-posts">
                        <h2>Related questions</h2>

                        @foreach (var item in ViewData["relatedQuestions"] as List<ChangeTable>)
                {

                            <ul class="related-posts">
                                <li class="related-item"><h3><a href="@item.SearchTitle"><i class="icon-double-angle-right"></i>@item.Title</a></h3></li>
                            </ul>
                        }
                    </div><!-- End related-posts -->
                }

                <div id="commentlist" class="page-content">
                    <div class="boxedtitle page-title"><h2>Proposals ( <span class="color">@Model.Count</span> )</h2></div>

                    <div class="tabs-warp question-tab">
                        <ul class="tabs">
                            <li class="tab"><a href="#" class="current">Top Voted</a></li>
                            <li class="tab"><a href="#" id="@change.Id" class="NewTab">New</a></li>
                            @*<li class="tab"><a href="#" id="@change.Id" class="trending">Trending</a></li>*@
                        </ul>

                        <div class="tab-inner-warp">
                            <div class="tab-inner">
                                <div class="tab-inner">
                                    @foreach (var comment in Model) //ViewData["comments"] as List<CommentTable>)
                                    {
                                        <ol class="commentlist clearfix">
                                            <li class="comment">
                                                <div class="comment-body comment-body-answered clearfix">
                                                    <div class="avatar"><img alt="" src="http://placehold.it/60x60/FFF/444"></div>
                                                    <div id="comment-text_@comment.Id" class="comment-text">
                                                        <div class="author clearfix">
                                                            <div class="comment-author"><a href="#"> @comment.User.FirstName</a></div>
                                                            <div class="comment-vote">
                                                                <ul class="question-vote">
                                                                    <li><a id="@comment.Id" class="question-vote-up voteUp" title="Like"></a></li>
                                                                    <li><a id="@comment.Id" class="question-vote-down voteDown" title="Dislike"></a></li>
                                                                </ul>
                                                            </div>
                                                            <span class="question-vote-result">+@comment.TotalVotes</span>
                                                            <div class="comment-meta">
                                                                <div class="date"><i class="icon-time"></i>@comment.TimeStamp</div>
                                                            </div>
                                                            @*<a id="btnReply" class="comment-reply" commentId="@comment.Id"><i class="icon-reply"></i>Reply</a>*@
                                                        </div>



                                                        <div class="text">
                                                            <p id="commentText_@comment.Id">@comment.Content</p>
                                                            @if (comment.SeeMore)
                                                            {
                                                                <span id="moreSpan_@comment.Id"><a id="@comment.Id" class="more moreTag">...more</a></span>
                                                            }
                                                        </div>
                                                        @*<div class="question-answered question-answered-done"><i class="icon-ok"></i>Best Answer</div>*@
                                                    </div>
                                                </div>

                                                @if (comment.ChildComments != null)
                                                {
                                                    foreach (var childComment in comment.ChildComments)
                                                    {
                                                        <ul class="children">
                                                            <li class="comment">
                                                                <div class="comment-body clearfix">
                                                                    <div class="avatar"><img alt="" src="http://placehold.it/60x60/FFF/444"></div>
                                                                    <div class="comment-text">
                                                                        <div class="author clearfix">
                                                                            <div class="comment-author"><a href="#">vbegy</a></div>
                                                                            <div class="comment-vote">
                                                                                <ul class="question-vote">
                                                                                    <li><a href="#" class="question-vote-up" title="Like"></a></li>
                                                                                    <li><a href="#" class="question-vote-down" title="Dislike"></a></li>
                                                                                </ul>
                                                                            </div>
                                                                            <span class="question-vote-result">+1</span>
                                                                            <div class="comment-meta">
                                                                                <div class="date"><i class="icon-time"></i>January 15 , 2014 at 10:00 pm</div>
                                                                            </div>
                                                                            <a class="comment-reply" href="#"><i class="icon-reply"></i>Reply</a>
                                                                        </div>
                                                                        <div class="text">
                                                                            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi adipiscing gravida odio, sit amet suscipit risus ultrices eu. Fusce viverra neque at purus laoreet consequat. Vivamus vulputate posuere nisl quis consequat.</p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <ul class="children">
                                                                    <li class="comment">
                                                                        <div class="comment-body clearfix">
                                                                            <div class="avatar"><img alt="" src="http://placehold.it/60x60/FFF/444"></div>
                                                                            <div class="comment-text">
                                                                                <div class="author clearfix">
                                                                                    <div class="comment-author"><a href="#">admin</a></div>
                                                                                    <div class="comment-vote">
                                                                                        <ul class="question-vote">
                                                                                            <li><a href="#" class="question-vote-up" title="Like"></a></li>
                                                                                            <li><a href="#" class="question-vote-down" title="Dislike"></a></li>
                                                                                        </ul>
                                                                                    </div>
                                                                                    <span class="question-vote-result">+9</span>
                                                                                    <div class="comment-meta">
                                                                                        <div class="date"><i class="icon-time"></i>January 15 , 2014 at 10:00 pm</div>
                                                                                    </div>
                                                                                    <a class="comment-reply" href="#"><i class="icon-reply"></i>Reply</a>
                                                                                </div>
                                                                                <div class="text">
                                                                                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi adipiscing gravida odio, sit amet suscipit risus ultrices eu. Fusce viverra neque at purus laoreet consequat. Vivamus vulputate posuere nisl quis consequat.</p>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </li>
                                                                </ul><!-- End children -->
                                                            </li>
                                                            <li class="comment">
                                                                <div class="comment-body clearfix">
                                                                    <div class="avatar"><img alt="" src="http://placehold.it/60x60/FFF/444"></div>
                                                                    <div class="comment-text">
                                                                        <div class="author clearfix">
                                                                            <div class="comment-author"><a href="#">ahmed</a></div>
                                                                            <div class="comment-vote">
                                                                                <ul class="question-vote">
                                                                                    <li><a href="#" class="question-vote-up" title="Like"></a></li>
                                                                                    <li><a href="#" class="question-vote-down" title="Dislike"></a></li>
                                                                                </ul>
                                                                            </div>
                                                                            <span class="question-vote-result">-3</span>
                                                                            <div class="comment-meta">
                                                                                <div class="date"><i class="icon-time"></i>January 15 , 2014 at 10:00 pm</div>
                                                                            </div>
                                                                            <a class="comment-reply" href="#"><i class="icon-reply"></i>Reply</a>
                                                                        </div>
                                                                        <div class="text">
                                                                            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi adipiscing gravida odio, sit amet suscipit risus ultrices eu. Fusce viverra neque at purus laoreet consequat. Vivamus vulputate posuere nisl quis consequat.</p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </li>
                                                        </ul><!-- End children -->

                                                    }
                                                }
                                            </li>

                                        </ol><!-- End commentlist -->
                                    }
                                </div>
                            </div>
                        </div>

                        <div class="tab-inner-warp">
                            <div class="tab-inner">

                                <div id="newComments"></div>
                            </div>
                        </div>


                        <div class="tab-inner-warp">
                            <div class="tab-inner">
                                <div class="tab-inner">
                                    @foreach (var comment in Model)
                                    {
                                        <ol class="commentlist clearfix">
                                            <li class="comment">
                                                <div class="comment-body comment-body-answered clearfix">
                                                    <div class="avatar"><img alt="" src="http://placehold.it/60x60/FFF/444"></div>
                                                    <div id="comment-text_@comment.Id" class="comment-text">
                                                        <div class="author clearfix">
                                                            <div class="comment-author"><a href="#">@comment.User.FirstName</a></div>
                                                            <div class="comment-vote">
                                                                <ul class="question-vote">
                                                                    <li><a id="@comment.Id" class="question-vote-up voteUp" title="Like"></a></li>
                                                                    <li><a id="@comment.Id" class="question-vote-down voteDown" title="Dislike"></a></li>
                                                                </ul>
                                                            </div>
                                                            <span class="question-vote-result">+@comment.TotalVotes</span>
                                                            <div class="comment-meta">
                                                                <div class="date"><i class="icon-time"></i>@comment.TimeStamp</div>
                                                            </div>
                                                            <a class="comment-reply" ><i class="icon-reply"></i>Reply</a>
                                                        </div>



                                                        <div class="text">
                                                            <p id="commentText_@comment.Id">@comment.Content</p>
                                                            @if (comment.SeeMore)
                                                            {
                                                                <span id="moreSpan_@comment.Id"><a id="@comment.Id" class="more moreTag">...more</a></span>
                                                            }
                                                        </div>
                                                        @*<div class="question-answered question-answered-done"><i class="icon-ok"></i>Best Answer</div>*@
                                                    </div>
                                                </div>

                                                @if (comment.ChildComments != null)
                                                {
                                                    foreach (var childComment in comment.ChildComments)
                                                    {
                                                        <ul class="children">
                                                            <li class="comment">
                                                                <div class="comment-body clearfix">
                                                                    <div class="avatar"><img alt="" src="http://placehold.it/60x60/FFF/444"></div>
                                                                    <div class="comment-text">
                                                                        <div class="author clearfix">
                                                                            <div class="comment-author"><a href="#">vbegy</a></div>
                                                                            <div class="comment-vote">
                                                                                <ul class="question-vote">
                                                                                    <li><a href="#" class="question-vote-up" title="Like"></a></li>
                                                                                    <li><a href="#" class="question-vote-down" title="Dislike"></a></li>
                                                                                </ul>
                                                                            </div>
                                                                            <span class="question-vote-result">+1</span>
                                                                            <div class="comment-meta">
                                                                                <div class="date"><i class="icon-time"></i>January 15 , 2014 at 10:00 pm</div>
                                                                            </div>
                                                                            <a class="comment-reply" href="#"><i class="icon-reply"></i>Reply</a>
                                                                        </div>
                                                                        <div class="text">
                                                                            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi adipiscing gravida odio, sit amet suscipit risus ultrices eu. Fusce viverra neque at purus laoreet consequat. Vivamus vulputate posuere nisl quis consequat.</p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <ul class="children">
                                                                    <li class="comment">
                                                                        <div class="comment-body clearfix">
                                                                            <div class="avatar"><img alt="" src="http://placehold.it/60x60/FFF/444"></div>
                                                                            <div class="comment-text">
                                                                                <div class="author clearfix">
                                                                                    <div class="comment-author"><a href="#">admin</a></div>
                                                                                    <div class="comment-vote">
                                                                                        <ul class="question-vote">
                                                                                            <li><a href="#" class="question-vote-up" title="Like"></a></li>
                                                                                            <li><a href="#" class="question-vote-down" title="Dislike"></a></li>
                                                                                        </ul>
                                                                                    </div>
                                                                                    <span class="question-vote-result">+9</span>
                                                                                    <div class="comment-meta">
                                                                                        <div class="date"><i class="icon-time"></i>January 15 , 2014 at 10:00 pm</div>
                                                                                    </div>
                                                                                    <a class="comment-reply" href="#"><i class="icon-reply"></i>Reply</a>
                                                                                </div>
                                                                                <div class="text">
                                                                                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi adipiscing gravida odio, sit amet suscipit risus ultrices eu. Fusce viverra neque at purus laoreet consequat. Vivamus vulputate posuere nisl quis consequat.</p>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </li>
                                                                </ul><!-- End children -->
                                                            </li>
                                                            <li class="comment">
                                                                <div class="comment-body clearfix">
                                                                    <div class="avatar"><img alt="" src="http://placehold.it/60x60/FFF/444"></div>
                                                                    <div class="comment-text">
                                                                        <div class="author clearfix">
                                                                            <div class="comment-author"><a href="#">ahmed</a></div>
                                                                            <div class="comment-vote">
                                                                                <ul class="question-vote">
                                                                                    <li><a href="#" class="question-vote-up" title="Like"></a></li>
                                                                                    <li><a href="#" class="question-vote-down" title="Dislike"></a></li>
                                                                                </ul>
                                                                            </div>
                                                                            <span class="question-vote-result">-3</span>
                                                                            <div class="comment-meta">
                                                                                <div class="date"><i class="icon-time"></i>January 15 , 2014 at 10:00 pm</div>
                                                                            </div>
                                                                            <a class="comment-reply" href="#"><i class="icon-reply"></i>Reply</a>
                                                                        </div>
                                                                        <div class="text">
                                                                            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi adipiscing gravida odio, sit amet suscipit risus ultrices eu. Fusce viverra neque at purus laoreet consequat. Vivamus vulputate posuere nisl quis consequat.</p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </li>
                                                        </ul><!-- End children -->

                                                    }
                                                }
                                            </li>

                                        </ol><!-- End commentlist -->
                                    }
                                </div>
                            </div>
                        </div>
                    </div>




                </div><!-- End page-content -->
                @if (User.Identity.IsAuthenticated)
                {
                    <div>@Html.Action("LeaveReply", "Change", new { changeId = @change.Id })</div>
                }
                else
                {
                    <div>@Html.Action("AnonymousReply", "Change", new { changeId = @change.Id })</div>
                }

            </div><!-- End main -->
        </div><!-- End row -->
    </section>

    <script>
        $(document).on("click", ".moreTag", function () {
            var commentId = $(this).attr("id");
            tag = $(this);
            $.ajax({
                url: '/change/GetFullComment',
                type: "POST",
                data: { commentId: commentId },
                success: function (data) {
                    $("<span id=commentSpan_"+commentId+">" + data + "</span>").insertAfter("#commentText_" + commentId);
                    debugger;
                    tag.removeClass("moreTag");
                    tag.addClass("lessTag");
                    tag.text("less");
                },
                error: function (xhr,status) {
                    alert('error');
                }
            });
        });

        $(document).on("click", ".lessTag", function () {
            var commentId = $(this).attr("id");
            tag = $(this);
            $("#commentSpan_" + commentId).empty();
            tag.text("more");
            tag.removeClass("lessTag");
            tag.addClass("moreTag");

        });
        $(document).on("click", ".voteUp", function () {
            var commentId = $(this).attr("id");
            $.ajax({
                url: "/change/castVote",
                type: "POST",
                data: {
                    commentId: commentId,
                    VoteStatus: true
                },
                success: function (data) {

                },
                error: function (xhr, status) {
                    console.log("error");
                }
            })


        });
        $(document).on("click", ".voteDown", function () {
            var commentId = $(this).attr("id");
            $.ajax({
                url: "/change/castVote",
                type: "POST",
                data: {
                    commentId: commentId,
                    VoteStatus: false
                },
                success: function (data) {

                },
                error: function (xhr, status) {
                    console.log("error");
                }
            })
        })


        $('.NewTab').click(function () {
            var changeId = $(this).attr("id");
            $.ajax({
                url: "/change/NewProposal",
                type: "POST",
                data: {
                    Id: changeId
                },
                success: function (data) {
                    debugger;
                    console.log(data);
                    for (var i = 0; i < data.length; i++) {
                        if (data[i].SeeMore == true) {

                            var seeMore = '<span id="moreSpan'+data[i].Id+'"><a id="'+data[i].Id+'" class="more moreTag">...more</a></span>';
                        }else{
                            seeMore = '';
                        }
                        $("#newComments").append('<ol class="commentlist clearfix"> <li class="comment"> <div class="comment-body comment-body-answered clearfix"> <div class="avatar"><img alt="" src="http://placehold.it/60x60/FFF/444"></div> <div class="comment-text"> <div class="author clearfix"> <div class="comment-author"><a href="#">'+data[i].User.FirstName+'</a></div> <div class="comment-vote"> <ul class="question-vote"> <li><a id='+data[i].Id+' class="question-vote-up voteUp" title="Like"></a></li> <li><a id='+data[i].Id+' class="question-vote-down voteDown" title="Dislike"></a></li> </ul> </div> <span class="question-vote-result">'+data[i].TotalVotes+'</span> <div class="comment-meta"> <div class="date"><i class="icon-time"></i>'+data[i].TimeStamp+'</div> </div> <a class="comment-reply" href="#"><i class="icon-reply"></i>Reply</a> </div> <div class="text"> <p id="commentText_'+data[i].Id+'">'+data[i].Content+'</p> '+ seeMore+'</div> </div>  </div> </div> </div>');
                    }
                },
                error: function (xhr, status) {
                    console.log("error");
                }
            })
        });

        //$(".trending").click(function () {

        //    var changeId = $(this).attr("id");
        //    $.ajax({
        //        url: "/change/Trending",
        //        type: "POST",
        //        data: {
        //            Id: changeId
        //        },
        //        success: function (data) {
        //            debugger;
        //            console.log(data);
        //            for (var i = 0; i < data.length; i++) {
        //                if (data[i].SeeMore == true) {

        //                    var seeMore = '<span id="moreSpan'+data[i].Id+'"><a id="'+data[i].Id+'" class="more moreTag">...more</a></span>';
        //                }else{
        //                    seeMore = '';
        //                }
        //                $("#newComments").append('<ol class="commentlist clearfix"> <li class="comment"> <div class="comment-body comment-body-answered clearfix"> <div class="avatar"><img alt="" src="http://placehold.it/60x60/FFF/444"></div> <div class="comment-text"> <div class="author clearfix"> <div class="comment-author"><a href="#">'+data[i].User.FirstName+'</a></div> <div class="comment-vote"> <ul class="question-vote"> <li><a id='+data[i].Id+' class="question-vote-up voteUp" title="Like"></a></li> <li><a id='+data[i].Id+' class="question-vote-down voteDown" title="Dislike"></a></li> </ul> </div> <span class="question-vote-result">'+data[i].TotalVotes+'</span> <div class="comment-meta"> <div class="date"><i class="icon-time"></i>'+data[i].TimeStamp+'</div> </div> <a class="comment-reply" href="#"><i class="icon-reply"></i>Reply</a> </div> <div class="text"> <p id="commentText_'+data[i].Id+'">'+data[i].Content+'</p> '+ seeMore+'</div> </div>  </div> </div> </div>');
        //            }
        //        },
        //        error: function (xhr, status) {
        //            console.log("error");
        //        }
        //    })
        //});

        $("#searchInput").keypress(function (e) {

            if (e.keyCode == 32) {
                var search = $("#searchInput").val();
                $.ajax({
                    url: "/change/SearchChange",
                    type: "POST",
                    data:{SearchText: search},
                    success: function (data) {
                        console.log(data);
                        debugger;
                        for (var i = 0; i < data.length; i++) {
                            $("#precursorList").append('<li class="list-group-item"><span>' + data[i].Title + '</span> <span class=""><input id="addPrecursorbtn" type="button" class="btn btn-primary" value="Add" changeId="'+data[i].Id+'"/></span></li>')
                        }

                    },
                    error: function (xhr, status) {
                        console.log("error");
                    }
                })
            }
        });
        $(document).on("click", "#addPrecursorbtn", function () {
            var changeId = $(this).attr("changeId");
            $.ajax({
                url: "/change/AddPrecursor",
                type: "POST",
                data: {
                    changeId: changeId,
                    MainChangeId:@change.Id,
                },
                success: function (data) {
                    console.log(data);
                    alert(data.Message);

                },
                error: function (xhr, status) {
                    console.log("error");
                }
            })
        });
        $("#btnAddConstraint").click(function(){
            debugger;
            var constraintText= $("#txtAddConstraint").val();
            $.ajax({
                url: "/change/AddConstraint",
                type: "POST",
                data: {
                    changeId: @change.Id,
                    content:constraintText,
                },
                success: function (data) {
                    console.log(data);
                    alert(data.Message);

                },
                error: function (xhr, status) {
                    console.log("error");
                }
            })


        });
        $("#btnFollow").click(function(){
            $.ajax({
                url: "/change/FollowChange",
                type: "POST",
                data: {
                    changeId: @change.Id,
                },
                success: function (data) {
                    console.log(data);
                    alert(data.Message);
                },
                error: function (xhr, status) {
                    console.log("error");
                }
            })

        });
        $("#btnFollowUser").click(function(){

            $.ajax({
                url: "/User/FollowUser",
                type: "POST",
                data: {
                    MainUserId:@user.Id,
                },
                success: function (data) {
                    console.log(data);
                    alert(data.Message);
                },
                error: function (xhr, status) {
                    console.log("error");
                }
            })

        });

        //$(document).on("click", "#btnReply", function () {
        //    var id=$(this).attr("commentId")
        //    $("#comment-text_"+id).append("<div><textarea id='childComment_"+id+"' rows='4' cols='100'></textarea><input id='addChildComment' commentId="+id+" type='button' value='Add' class='btn'/></div>");
        //});
        @*$(document).on("click", "#addChildComment", function () {
            debugger;
            var id = $(this).attr("commentId");
            var content = $("#childComment_"+id).val();
            var changeId = @change.Id;
            $.ajax({
                url: "/Change/AddChildComment",
                type: "POST",
                data: {
                    Id:id,
                    changeId:changeId,
                    Content:content
                },
                success: function (data) {
                    console.log(data);
                    alert(data.Message);
                },
                error: function (xhr, status) {
                    console.log("error");
                }
            })
        })*@
    </script>
